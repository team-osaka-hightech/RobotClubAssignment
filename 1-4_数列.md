# 1-4. 数列

数列とは，名前の通り『数が列になった（連なった）もの』です。例えば次のようなものがあります。  

$$
1,2,3,4,5, \cdots \
1,2,4,8,16, \cdots \
1,2,4,7,11, \cdots \
1,1,2,3,5,8, \cdots \
$$

これらの規則性を説明できるでしょうか？頭の体操レベルで何となく出来そうですね。  
では，この規則性が分かったところで100番目の数字はいくつになるか求めてみましょう。数列によりますが，大体は気の遠くなる作業になりそうです。  

そんなとき，数列を式を使って厳密に表すことにしましょう。例えば，

$$
1,3,5,7,9, \cdots \\
$$

という数列は1から始まって2ずつ増えていくという規則性があります。  
これを自然数 $n=1,2,3, \cdots$ を使って表すと，

$$
S_n = 2n - 1
$$

となります。実際に， $n$ に自然数を入れていきましょう。

$$
S_1 = 2*1-1=1 \\
S_2 = 2*2-1=3 \\
S_3 = 2*3-1=5 \\
S_4 = 2*4-1=7 \\
S_5 = 2*5-1=9
$$

$n$ を1,2,3,4,…と数えていけば $S_n$ は1,3,5,7,…となりました。ここで $S_n=2n-1$ のように数列を表す式のことを __一般項__ といいます。  
表にまとめて整理してみるもの良いです。  

|$n$|1|2|3|4|5|…|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$S_n$|1|3|5|7|9|…|


## 1-4-1. 数列の種類

高校レベルで扱う数列は2種類+応用パターン1種あります。それぞれに公式があるので，数列の種類を見極めて公式を適用することで一般項を導くことができます。  

### ①等差数列
等差数列は，1,3,5,7,…のように，増え方（減り方）が一定の数列です。『（数どうしの）差が等しい』という意味ですね。  

一般項の公式は

$$
a_n=a_1+(n-1)d
$$

です。 $a_1$ は初項（数列の始めの数）， $d$ は公差（隣り合う数どうしの差）です。

### ②等比数列
等比数列は，1,2,4,8,…のように，隣り合う数どうしが $x$ 倍（または $\frac{1}{x}$ 倍）の数列です。1と2は2倍違う，2と4も2倍違う，…というように『比が等しい』という意味です。  

こちらの一般項は

$$
a_n=a_1 \cdot r^{n-1}
$$

です。 $a_1$ は初項（数列の始めの数）， $r$ は公比（隣り合う数どうしの比）です。隣り合う数が2倍違えば公比は2ということになります。  

### ③（応用）階差型の数列
1,2,4,7,…のように，増え方（減り方）が規則性を持って変化する数列で，その隣り合う要素の差分を取った新たな数列 $b_k$ のことを階差数列といいます。元の数列 $a_n$ を階差数列と呼ばない点に注意してください。  
$a_n$ の差分を取った $b_k$ を第1階差数列， $b_k$ の差分を取った $c_k$ を第2階差数列といいます。  
今回はPythonのプログラミングの練習が目的なので，1階の差分を取れば等差数列となる例のみを扱います。  

【階差数列を説明する図】

こちらの一般項は

$$
a_n=a_1 + \sum^{n-1}_{k=1}b_k
$$

です。 数列 $b_n$ の総和を求める必要があるのでややこしい感じがしますね。1要素ずつ見て上手くいくことを確かめましょう。  
数列1,2,4,7,…の初項は $a_1=1$ ，差分を取った新たな数列は1,2,3,…なので $b_n=n$です。  

$$
\begin{align}
&a_1 = 1 \\
&a_2 = a_1+\sum^1_{k=1}b_k=a_1+b_1=1+1=2 \\
&a_3 = a_1+\sum^2_{k=1}b_k=a_1+(b_1+b_2)=1+(1+2)=4 \\
&a_4 = a_1+\sum^3_{k=1}b_k=a_1+(b_1+b_2+b_3)=1+(1+2+3)=7 \\
&a_5 = a_1+\sum^4_{k=1}b_k=a_1+(b_1+b_2+b_3+b_4)=1+(1+2+3+4)=11 \\
\end{align}
$$

|$n$|1|2|3|4|5|…|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$a_n$|1|2|4|7|11|…|

こちらの総和記号 $\sum$ は公式を使ってを外すことができます。  

$$
\sum^{n-1}_{k=1}k=\frac{1}{2}(n-1)n
$$

特に， $k$ が数列ではなく定数 $c$ の場合，

$$
\sum^{n-1}_{k=1}c=(n-1)c　(c:定数)
$$

となります。ちょっと例題を見てみましょう。数列1,4,9,16,…の隣同士の数の差をとった等差数列は $ b_k=3,5,7,\cdots=3+2(k-1)=1+2k$ なので

$$
\sum^{n-1}_{k=1}(1+2k)=\sum^{n-1}_{k=1}(n-1)+2\sum^{n-1}_{k=1}k=n+2 \cdot \frac{1}{2}(n-1)n=n^2
$$

と，きれいにまとまります。  
手順としては，①項ごとに分解，② $k$ についた係数は総和記号の外に出す，③公式を使って総和記号を外す，④ $n$ の多項式を整理，となります。

## 1-4-2. 練習
3種類の数列を練習してみましょう。
1. 数列 $2,4,6,8,10,\cdots$ の初項 $a_1$ と等差 $d$ を答えましょう。またこの数列の一般項 $a_n$ を求めて， $n=100$ のときの値 $a_{100}$ を計算しましょう。

1. 数列 $3,6,12,24,48,\cdots$ の初項 $a_1$ と等比 $r$ を答えましょう。またこの数列の一般項 $a_n$ を求めて， $n=10$ のときの値 $a_{10}$ を計算しましょう。

1. 数列 $1,3,7,13,21,\cdots$ の隣どうしの数の差を等差数列 $b_k$ で表し，一般項を求めましょう。次に，この数列の一般項 $a_n$ を求めて， $n=10$ のときの値 $a_{10}$ を計算しましょう。



|問題|答え|
|:-:|-|
|1|$a_1=2 \\ d=2 \\ a_n=2+2(n-1) \\ a_{100}=200$|
|2|$a_1=3 \\ r=2 \\ a_n=3 \cdot 2^{n-1} \\ a_{10}=1536$|
|3|$b_k=2,4,6, \cdots = 2+2(k-1)=2k\\ a_n=1+\sum^{n-1}_{k=1}2k=1+(n-1)n \\ a_{10}=91$|


## 1-4-3. Pythonでの実装
これまでは数列を手計算してきました。次はPythonで数列を使った問題を解くプログラムを作っていきましょう。

### 数列を作る
数列を作るには`range()`を用いるのが良いでしょう。`range()`は`range(start, end, step)`という形式で使い，startとstepは省略可です。startを省略すると0始まり，stepを省略すると1刻みとなります。  
endで指定した値の一つ手前で停止する点に注意しましょう。  

```Python
# forループ内で表示
for x in range(0,3):
    print(x)

# リスト内包表記を使って格納
num_seq = [i for i in range(0, 3)]
print(num_seq)
```

機械学習プログラムを作る際にも役に立つテクニックですが，for文はなるべく使わない方が高速に動作します。このためリスト内包表記を使うことをおすすめします。  

では次，色々な数列を作ってみましょう。リスト内包表記を使えば，基本的に`range()`はstepは省略して1刻みでOKです。一般項を求めたら $n$ を $i$ に置き換えた式を入れましょう。  
なお，startは1でendは必要なリストの長さに応じて変更してください。  

```python
# 等差数列
num_seq1 = [2+2*(i-1) for i in range(1,6)]
print(num_seq1) # [2, 4, 6, 8, 10]

# 等比数列
num_seq2 = [1*2**(i-1) for i in range(1,6)]
print(num_seq2) # [1, 2, 4, 8, 16]

# 階差型の数列
num_seq3 = [1+(i-1)*i for i in range(1, 6)]
print(num_seq3) # [1, 3, 7, 13, 21]
```

### 数列を判定する
与えられた数列が等差数列・等比数列・階差型の数列のいずれか判定するプログラムを作ります。  
ここでおさらいですが，各数列は次のようなものです。
- 等差数列：増え方（減り方）が一定
- 等比数列：隣り合う数どうしが $x$ 倍（または $\frac{1}{x}$ 倍）
- 階差型の数列：増え方（減り方）が規則性を持って変化する ※ここでは第1階差数列が等差数列のもの

有限長の数列に対して，それぞれ判定する関数を示します。  

#### ① 等差数列かどうか判定

```python
num_seq1 = [1,3,5,7,9] # 等差数列
num_seq2 = [1,3,4,6,7] # 等差数列ではない

def judge_common_difference(seq):
    sq = [x - y for x, y in zip(seq[1:], seq[:-1])]
    return sq.count(sq[0]) == len(sq) # 隣り合う要素の差分が全て同じか

print(num_seq1, "は", "等差数列です" if judge_common_difference(num_seq1) else "等差数列ではありません")
print(num_seq2, "は", "等差数列です" if judge_common_difference(num_seq2) else "等差数列ではありません")
```

#### ② 等比数列かどうか判定

```python
num_seq1 = [1,2,4,8,16] # 等比数列
num_seq2 = [1,2,6,12,36] # 等比数列ではない

def judge_common_retio(seq):
    sq = [x / y for x, y in zip(seq[1:], seq[:-1])]
    return sq.count(sq[0]) == len(sq) # 隣り合う要素の比が全て同じか

print(num_seq1, "は", "等比数列です" if judge_common_retio(num_seq1) else "等比数列ではありません")
print(num_seq2, "は", "等比数列です" if judge_common_retio(num_seq2) else "等比数列ではありません")
```


#### ③ 階差型の数列かどうか判定

```python
num_seq1 = [1,2,4,7,11] # 第1階差数列が等差数列
num_seq2 = [1,2,6,12,36] # 第1階差数列が等差数列ではない

def judge_seq_diffs(seq):
    sq = [x - y for x, y in zip(seq[1:], seq[:-1])]
    return judge_common_difference(sq) # 隣り合う要素の差分をとった数列が等差数列か

print(num_seq1, "は", "階差型の数列です" if judge_seq_diffs(num_seq1) else "階差型の数列ではありません")
print(num_seq2, "は", "階差型の数列です" if judge_seq_diffs(num_seq2) else "階差型の数列ではありません")
```





## 課題
1. 次の数列の一般項を<u>手計算</u>で求めて，これに続く数列を10個表示するPythonプログラムを作りましょう。
    - $4,6,8,10\cdots$
    - $3,9,27,81\cdots$
    - $1,5,13,25,\cdots$

1. 次の数列が等差数列・等比数列・第1階差数列が等差数列かどうか判定し，結果を表示するプログラムを作りましょう。
    - $2008,2012,2016,2020,2024$
    - $16,24,36,54,81$
    - $2,10,24,44,70$

1. 前問のプログラムを改造して次の数列の種類を判定し，一般項を求めるプログラムを作りましょう。
    - $120,240,360,480,600,\cdots$
    - $3,6,12,24,48,\cdots$
    - $1,2,5,10,17,\cdots$
